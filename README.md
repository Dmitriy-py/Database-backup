# Домашнее задание к занятию «Резервное копирование баз данных»

## ` Дмитрий Климов `

### Задание 1. Резервное копирование

Кейс
Финансовая компания решила увеличить надёжность работы баз данных и их резервного копирования.

Необходимо описать, какие варианты резервного копирования подходят в случаях:

1.1. Необходимо восстанавливать данные в полном объёме за предыдущий день.

1.2. Необходимо восстанавливать данные за час до предполагаемой поломки.

1.3.* Возможен ли кейс, когда при поломке базы происходило моментальное переключение на работающую или починенную базу данных.

Приведите ответ в свободной форме.

## Ответ:

### ` 1.1. Восстановление данных в полном объеме за предыдущий день: `

Подходящий вариант: Полное резервное копирование (Full Backup) в сочетании с инкрементным/дифференциальным резервным копированием.

Полное резервное копирование: Каждый день в определенное время (например, ночью, когда наименьшая нагрузка) делается полное резервное копирование всей базы данных. Это создает полную копию, с которой можно быстро восстановиться на состояние вчерашнего дня.

Инкрементное/Дифференциальное резервное копирование (опционально, но рекомендуется): Для ускорения восстановления и снижения нагрузки на систему в течение дня можно использовать инкрементное или дифференциальное резервное копирование.

Инкрементное: Копирует только те данные, которые изменились с момента последнего резервного копирования (полного или инкрементного). Восстановление требует полного бэкапа и всех последующих инкрементных.
Дифференциальное: Копирует данные, которые изменились с момента последнего полного резервного копирования. Восстановление требует полного бэкапа и последнего дифференциального.
Преимущества: Простота реализации полного резервного копирования. Быстрое восстановление до состояния вчерашнего дня.

Недостатки: Полные резервные копии занимают много места. Восстановление из инкрементных бэкапов может быть более долгим.

### ` 1.2. Восстановление данных за час до предполагаемой поломки: `

Подходящий вариант: Транзакционные логи (Transaction Log Backups) в сочетании с полным резервным копированием.

Транзакционные логи: Записывают все изменения, происходящие в базе данных в режиме реального времени или с небольшим интервалом (например, каждые 5-15 минут). Они позволяют восстановить базу данных до определенного момента времени.

Полное резервное копирование: Необходимо периодически выполнять полные резервные копии, чтобы избежать экспоненциального роста файлов логов транзакций и обеспечить возможность восстановления в случае повреждения лог-файлов.

Процесс восстановления: Восстанавливается последняя полная копия базы данных, а затем применяются все логи транзакций, записанные с момента этой полной копии до момента времени, к которому необходимо восстановить данные (час до поломки).

Преимущества: Восстановление до конкретного момента времени с высокой точностью. Минимальная потеря данных.

Недостатки: Более сложная настройка и управление. Требуется больше места для хранения логов транзакций. Восстановление может занять больше времени, чем восстановление только из полной копии.

### ` 1.3*. Моментальное переключение на работающую или починенную базу данных: `

Да, такой кейс возможен. Подходящие варианты: Кластеризация (Clustering) и Репликация (Replication).

Кластеризация: Несколько серверов базы данных работают вместе как один, обеспечивая высокую доступность. Если один сервер выходит из строя, другие автоматически берут на себя его нагрузку.

Репликация: Данные реплицируются (копируются) в режиме реального времени или почти реального времени на один или несколько резервных серверов. В случае сбоя основного сервера, один из резервных серверов может быть быстро активирован как новый основной сервер (failover). Репликация бывает нескольких типов:

Синхронная репликация: Транзакции записываются одновременно на основной и резервный серверы. Обеспечивает наименьшую потерю данных, но может влиять на производительность.
Асинхронная репликация: Транзакции сначала записываются на основной сервер, а затем передаются на резервный. Меньше влияет на производительность, но возможна небольшая потеря данных в случае сбоя основного сервера.
Преимущества: Минимальное время простоя. Высокая доступность. Автоматическое переключение в случае сбоя.

Недостатки: Наиболее сложная и дорогая в реализации. Требует значительных ресурсов. Необходим тщательный мониторинг и настройка.

Рекомендации для финансовой компании:

Использовать комбинацию подходов: Для достижения максимальной надежности и гибкости рекомендуется использовать комбинацию различных подходов к резервному копированию. Например, полное резервное копирование + транзакционные логи + репликация.
Регулярно тестировать резервные копии: Крайне важно регулярно тестировать восстановление из резервных копий, чтобы убедиться в их работоспособности и своевременно выявлять возможные проблемы.
Автоматизировать процессы: Максимально автоматизировать процессы резервного копирования и восстановления, чтобы минимизировать человеческий фактор и сократить время простоя.
Хранить резервные копии в разных местах: Хранить резервные копии как минимум в двух разных физических местах, чтобы защититься от различных катастроф (пожар, затопление и т.д.).
Шифровать резервные копии: Шифровать резервные копии, особенно если они хранятся в облаке или на внешних носителях, чтобы защитить конфиденциальные данные от несанкционированного доступа.
Выбрать правильную стратегию репликации: В зависимости от требований к допустимой потере данных и производительности следует выбрать синхронную или асинхронную репликацию.
Внедрить систему мониторинга: Постоянно мониторить состояние базы данных и процесса репликации для оперативного выявления и устранения проблем.
В заключение, выбор оптимальной стратегии резервного копирования зависит от конкретных требований и бюджета финансовой компании. Важно тщательно проанализировать все факторы и выбрать наиболее подходящий вариант.
